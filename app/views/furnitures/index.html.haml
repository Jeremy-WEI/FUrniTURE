%h1 Searching

= form_for @search do |f|
  .field
    = f.label :address
    = f.text_field :current_address
  .field
    = f.label :type
    = select(:type, :status, options_for_select([["canceled", "1"], ["pending", "2"], ["success", "3"]]))
    = f.text_field :type
  .field
    = f.label :price
    = f.text_field :price
  .field
    = f.label :distance
    = f.text_field :distance
  .actions
    = f.submit 'Search'


%h1 Listing furnitures

%table
  %thead
    %tr
      %th Title
      %th Tag
      %th Picture1
      %th Picture2
      %th Picture3
      %th Picture4
      %th Price
      %th Description
      %th Email
      %th Phone
      %th Latitude
      %th Longitude
      %th
      %th
      %th

  %tbody
    - @furnitures.each do |furniture|
      %tr
        %td= furniture.title
        %td= furniture.tag
        %td= furniture.picture1
        %td= furniture.picture2
        %td= furniture.picture3
        %td= furniture.picture4
        %td= furniture.price
        %td= furniture.description
        %td= furniture.email
        %td= furniture.phone
        %td= furniture.latitude
        %td= furniture.longitude
        %td= link_to 'Show', furniture
        %td= link_to 'Edit', edit_furniture_path(furniture)
        %td= link_to 'Destroy', furniture, :method => :delete, :data => { :confirm => 'Are you sure?' }

%br


-#= content_tag :div, class: "furnitures_class", data: {current: @currentLocation} do end
= content_tag :div, class: "furnitures_class", data: {furnitures: @furnitures, current: @currentLocation, miles: @miles} do end


#map-canvas

= link_to 'New Furniture', new_furniture_path

:javascript
  $(document).ready(function() {
    var currentLocation = $('.furnitures_class').data('current');
    var miles = $('.furnitures_class').data('miles');
    var mapOptions = {
      zoom: RadiusToZoom(miles),
      center: new google.maps.LatLng(currentLocation[0], currentLocation[1])
    };
    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var furnitures = $('.furnitures_class').data('furnitures');
    function initialize() {
        var here = new google.maps.Marker({
            position: new google.maps.LatLng(currentLocation[0], currentLocation[1]),
            map: map,
            icon: 'http://library.csun.edu/images/google_maps/marker-blue.png'
        })

        var i;
        for (i = 0; i < furnitures.length; i++) {
            var latlng = new google.maps.LatLng(furnitures[i].latitude, furnitures[i].longitude);
            var title = furnitures[i].title;

            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(furnitures[i].latitude, furnitures[i].longitude),
                map: map,
                title: title
            });
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function(){
                    var distance = 3;
                    var description = "<h3><strong>$"+furnitures[i].price+",&nbsp;</strong><strong>"+
                                       furnitures[i].title+",&nbsp;</strong><strong>"+distance+" miles from you</strong></h3><br>"+
                                       "<p>&nbsp; &nbsp; &nbsp;sell by Katie, post on "+furnitures[i].created_at+"</p><br>"+
                                       "<p>description: "+furnitures[i].description+"</p>";
                    new google.maps.InfoWindow({
                        content: description
                    }).open(map, marker);
                }
            })(marker, i));
        }
    }
    function RadiusToZoom(radius){
        return Math.round(14-Math.log(radius)/Math.LN2);
    }


    google.maps.event.addDomListener(window, 'load', initialize);
  });
